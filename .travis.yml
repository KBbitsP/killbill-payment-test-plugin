############################################################################################
#                                                                                          #
#                   Copyright 2010-2011 Ning, Inc.                                         #
#                   Copyright 2015 Groupon, Inc                                            #
#                   Copyright 2022 The Billing Project, LLC                                #
#                                                                                          #
#      The Billing Project licenses this file to you under the Apache License, version 2.0 #
#      (the "License"); you may not use this file except in compliance with the            #
#      License.  You may obtain a copy of the License at:                                  #
#                                                                                          #
#          http://www.apache.org/licenses/LICENSE-2.0                                      #
#                                                                                          #
#      Unless required by applicable law or agreed to in writing, software                 #
#      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT           #
#      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the           #
#      License for the specific language governing permissions and limitations             #
#      under the License.                                                                  #
#                                                                                          #
############################################################################################

language: ruby

sudo: false
cache: bundler

before_script:
  - bundle exec jbundle install

script: 'bundle exec rake spec'

notifications:
  email:
    - kill-bill-commits@googlegroups.com

env:
  global:
    - JRUBY_OPTS='-J-Xmx1024M'

rvm:
  - jruby-1.7.20
  - jruby-20mode # latest 1.7.x
  - jruby-head

gemfile:
  - Gemfile
  - Gemfile.head

jdk:
  - openjdk7
  - oraclejdk7
  - oraclejdk8

matrix:
  allow_failures:
    - rvm: jruby-head
    - jdk: oraclejdk8
    - gemfile: Gemfile.head
  fast_finish: true

after_success:
  - '[ "${TRAVIS_PULL_REQUEST}" = "false" ] && echo "<settings><servers><server><id>sonatype-nexus-snapshots</id><username>\${env.OSSRH_USER}</username><password>\${env.OSSRH_PASS}</password></server></servers></settings>" > ~/settings.xml && MVN="mvn --settings $HOME/settings.xml" NO_RELEASE=1 travis_retry travis_wait bash release.sh | egrep -v "Download|Install|Upload" ; rm -f ~/settings.xml'
